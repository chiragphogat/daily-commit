name: Daily Learning Update

permissions:
  contents: write   # ðŸ”‘ THIS FIXES THE 403 ERROR

on:
  schedule:
    # 12:00 PM IST = 06:30 UTC
    - cron: "30 6 * * *"
    # Sunday weekly summary at 12:05 PM IST
    - cron: "35 6 * * 0"
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.x"

      - name: Random human-like delay (0â€“5 min)
        run: sleep $((RANDOM % 300))

      - name: Daily update
        run: python scripts/daily_update.py

      - name: Weekly summary (Sunday only)
        run: python scripts/weekly_summary.py

      - name: Update streak
        run: python scripts/streak.py

      - name: Commit and push (if changed)
        run: |
          git config user.name "chiragphogat"
          git config user.email "chirag@users.noreply.github.com"

          git add .
          if git diff --cached --quiet; then
            echo "No changes today."
            exit 0
          fi

          messages=(
            "Daily learning update"
            "Worked on core CS concepts"
            "Sharpened problem-solving skills"
            "Consistency > intensity"
            "Learning log update"
          )

          msg=${messages[$RANDOM % ${#messages[@]}]}
          git commit -m "$msg"
          git push
