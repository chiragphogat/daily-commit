name: Learning Tracker Ultimate

on:
  schedule:
    - cron: "30 18 * * *"   # Daily at 12:00 AM IST
    - cron: "0 18 * * 0"    # Weekly report Sunday IST
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set git identity
        run: |
          git config user.name "Chirag Phogat"
          git config user.email "Phogatc8@gmail.com"

      - name: Daily update
        run: |
          TODAY=$(date '+%Y-%m-%d')
          echo "" >> daily_log.md
          echo "## $TODAY" >> daily_log.md
          echo "- Practiced coding, ML & security topics" >> daily_log.md

      - name: Update stats
        run: |
          TOTAL=$(grep -c "## " daily_log.md)
          echo "# Learning Stats" > stats.md
          echo "- Total days: $TOTAL" >> stats.md
          echo "- Last update: $(date '+%Y-%m-%d')" >> stats.md

      - name: Weekly report
        if: github.event.schedule == '0 18 * * 0'
        run: |
          echo "# Weekly Learning Report - $(date '+%Y-%m-%d')" > weekly_report.md
          tail -n 30 daily_log.md >> weekly_report.md

      - name: Commit and push
        run: |
          git add .
          git commit -m "Automated learning update $(date '+%Y-%m-%d')" || exit 0
          git push
